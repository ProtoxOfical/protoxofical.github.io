<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PrintGlow — Custom Apparel & Merch</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* -----------------------
      THEME & RESET
    ----------------------- */
    :root{
      --bg:#070a0f; --ink:#e5f1ff; --muted:#9db3c7; --accent:#61e7ff;
      --accent-2:#9a7bff; --danger:#ff6b6b; --card:#0f141d; --border:#1f2a3a;
      --glow:0 0 24px #61e7ff55; --radius:18px;
    }

    *,*::before,*::after{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0; font-family: 'Manrope', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink); background:var(--bg);
      overflow-x:hidden;
    }
    a{color:inherit; text-decoration:none}
    img{display:block; max-width:100%; height:auto; object-fit: cover;}
    button{font:inherit; background:none; border:none; color:inherit; cursor:pointer}
    ::selection{background:#61e7ff33}
    .hidden{display:none !important}

    /* -----------------------
      LANDING GATE
    ----------------------- */
    #landing-gate {
      position: fixed; inset: 0; z-index: 2000;
      background: var(--bg);
      opacity: 1; transition: opacity .8s cubic-bezier(0.7, 0, 0.3, 1);
    }
    #landing-gate.out { opacity: 0; pointer-events: none; }
    #three-canvas { position: absolute; inset: 0; }
    .gate-ui { position: absolute; inset: 0; pointer-events: none; }
    .gate-link {
      position: absolute; font-family: 'Space Grotesk', sans-serif;
      font-weight: 700; font-size: clamp(.9rem, 1.6vw, 1rem);
      color: var(--muted); text-transform: uppercase; letter-spacing: .08em;
      padding: 1rem; cursor: pointer; pointer-events: auto;
      transition: color .3s ease, text-shadow .3s ease;
    }
    .gate-link:hover { color: var(--ink); text-shadow: 0 0 12px var(--glow); }
    #gate-bl { bottom: 1rem; left: 1.5rem; }
    #gate-br { bottom: 1rem; right: 1.5rem; }
    
    #hamburger-btn {
      position: absolute; top: 1.5rem; left: 1.5rem;
      width: 48px; height: 48px; display: grid; place-items: center;
      cursor: pointer; pointer-events: auto; z-index: 2010;
    }
    #hamburger-btn .bar {
      width: 28px; height: 2px; background: var(--ink);
      border-radius: 2px; transition: all .3s ease-in-out;
    }
    #hamburger-btn .bar::before, #hamburger-btn .bar::after {
      content: ''; position: absolute; width: 28px; height: 2px;
      background: var(--ink); border-radius: 2px; transition: all .3s ease-in-out;
    }
    #hamburger-btn .bar::before { transform: translateY(-8px); }
    #hamburger-btn .bar::after { transform: translateY(8px); }

    #hamburger-btn.active .bar { background: transparent; }
    #hamburger-btn.active .bar::before { transform: rotate(45deg); }
    #hamburger-btn.active .bar::after { transform: rotate(-45deg); }

    #gate-menu {
      position: fixed; inset: 0; background: #070a0fdd;
      backdrop-filter: blur(10px); z-index: 2005;
      display: grid; place-items: center; text-align: center;
      opacity: 0; pointer-events: none; transform: translateY(-20px);
      transition: opacity .4s ease, transform .4s ease;
    }
    #gate-menu.open { opacity: 1; pointer-events: auto; transform: translateY(0); }
    #gate-menu nav { display: flex; flex-direction: column; gap: 1.5rem; }
    #gate-menu a {
      font-family: 'Space Grotesk'; font-size: clamp(1.5rem, 5vw, 2.5rem);
      color: var(--muted); font-weight: 600; text-transform: uppercase;
      letter-spacing: .1em; transition: color .3s ease;
    }
    #gate-menu a:hover { color: var(--ink); }

    /* -----------------------
      MAIN SITE WRAPPER
    ----------------------- */
    #main-content {
      position: relative; z-index: 100;
    }

    /* -----------------------
      GLOBAL UTILITIES
    ----------------------- */
    .container{width:min(1200px, 92%); margin-inline:auto}
    .grid{display:grid; gap:18px}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:.6rem; padding:.9rem 1.2rem; border-radius:999px; border:1px solid var(--border);
      background:linear-gradient(180deg,#0f141d,#0b1017); color:var(--ink); box-shadow:var(--glow);
      transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      cursor:pointer;
    }
    .btn:hover{transform:translateY(-2px); box-shadow:0 8px 30px #0008, var(--glow); border-color:#2a3a52}
    .btn-pill{padding:.72rem 1.1rem; font-weight:600}
    .btn-accent{background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:#071017; border-color:transparent}
    .btn[disabled] { opacity: 0.5; cursor: not-allowed; transform: none; }
    
    /* -----------------------
      HEADER & NAVIGATION
    ----------------------- */
    .header{
        position:sticky; top:0; z-index:100;
        backdrop-filter:saturate(160%) blur(8px);
        background:#0a1018cc;
        border-bottom:1px solid var(--border);
    }
    .header-inner{display:flex; align-items:center; justify-content:space-between; gap:1rem; padding:.8rem 0}
    .header-brand{font-family:'Space Grotesk', sans-serif; font-weight:700; font-size:1.4rem}
    .header-nav{display:flex; gap:.5rem}
    .header-nav a{padding:.5rem .8rem; font-weight:600; border-radius:8px; transition: background .2s ease, color .2s ease; color: var(--muted)}
    .header-nav a:hover, .header-nav a.active{color:var(--ink); background:#ffffff10}
    #cart-btn{position:relative}
    #cart-count{
        position:absolute; top:-4px; right:-8px; background:var(--accent); color:var(--bg);
        font-size:.7rem; font-weight:700; width:18px; height:18px;
        border-radius:50%; display:grid; place-items:center;
        transform: scale(0); transition: transform .2s ease;
    }
    #cart-count.visible{transform:scale(1)}

    /* -----------------------
      MAIN CONTENT & PAGES
    ----------------------- */
    main > section{padding: clamp(48px, 8vw, 96px) 0;}
    .section-title{font-family:'Space Grotesk', sans-serif; font-size:clamp(2.2rem,4vw,3rem)}
    .section-sub{color:var(--muted); margin:.4rem 0 1.5rem; max-width:60ch; line-height:1.7}
    .panel{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:clamp(1.5rem, 5vw, 2rem); box-shadow:0 10px 34px #0007}
    
    /* Form Fields */
    .field{display:grid; gap:8px; margin-bottom:1.2rem}
    .field label{font-weight:600; font-size: 0.9rem;}
    .field input, .field textarea, .field select {
      background:#0c131d; border:1px solid #223042; color:var(--ink); border-radius:12px; padding:.8rem .9rem; outline:none; font:inherit; width:100%;
    }
    .field input:focus, .field textarea:focus, .field select:focus {border-color:#34507a; box-shadow:0 0 0 3px #61e7ff22}
    
    /* Shop Page */
    .items-grid{grid-template-columns: repeat(auto-fill, minmax(240px, 1fr))}
    .card{background:linear-gradient(180deg,#0e1420,#0b111a); border:1px solid var(--border); border-radius:var(--radius);
      overflow:hidden; box-shadow:0 8px 30px #0006; transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease}
    
    /* Customize Page */
    .customizer-layout{display:grid; grid-template-columns: 300px 1fr; gap: 2rem; align-items: flex-start;}
    .customizer-main { display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; }

    /* Bulk Orders Page */
    .bulk-layout{display:grid; grid-template-columns: 1fr 420px; gap: 2rem; align-items: flex-start;}
    #bulk-quote-panel { position: sticky; top: 100px; }
    #bulk-quote-list { max-height: 40vh; overflow-y: auto; margin-bottom: 1rem; padding-right: .5rem; }
    .quote-item { display: grid; grid-template-columns: 60px 1fr auto; gap: 1rem; align-items: center; padding: .8rem 0; border-bottom: 1px solid var(--border); }
    .quote-item:first-child { padding-top: 0; }
    .quote-item-img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; background: var(--bg); }
    .quote-item-remove { font-size: .8rem; color: var(--danger); opacity: .7; }
    
    /* MODALS (Cart & Checkout) */
    .modal-overlay{
      position:fixed; inset:0; z-index:1000;
      background: #000000a0; backdrop-filter:blur(5px);
      display:grid; place-items:center;
      opacity:0; pointer-events:none; transition: opacity .3s ease;
    }
    .modal-overlay.visible{opacity:1; pointer-events:auto}
    .modal-content{
      background:var(--card); border-radius:var(--radius); border:1px solid var(--border);
      padding:2rem; box-shadow:0 20px 60px #00000088;
      width:min(600px, 95vw);
      transform:scale(0.95); transition: transform .3s ease;
    }
    .modal-overlay.visible .modal-content{transform:scale(1)}
    .modal-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem}
    .modal-title{font-family:'Space Grotesk'; font-size:1.5rem; margin:0}
    .modal-close-btn{font-size:1.5rem; line-height:1; color:var(--muted); opacity:0.7; transition:opacity .2s ease, transform .2s ease}
    
    /* Cart */
    #cart-items{max-height: 50vh; overflow-y:auto; padding-right:.5rem; margin-bottom:1.5rem}
    .cart-item{display:grid; grid-template-columns: 80px 1fr auto; gap:1rem; align-items:center; border-bottom:1px solid var(--border); padding:1rem 0}
    .cart-item-img{width:80px; height:80px; border-radius:12px; background:var(--bg); object-fit:cover}

    /* Checkout */
    #checkout-modal .modal-content { width: min(800px, 95vw); }
    .checkout-grid { display: grid; grid-template-columns: 1fr 300px; gap: 2rem; }
    .checkout-summary { border-left: 1px solid var(--border); padding-left: 2rem; }
    .checkout-step { animation: fadeIn .4s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* NOTIFICATION TOASTS */
    #notification-container{position:fixed; bottom:20px; right:20px; z-index:2000; display:flex; flex-direction:column; gap:10px}
    .toast{ background:var(--card); border:1px solid var(--border); padding:1rem 1.2rem; border-radius:12px; box-shadow:0 10px 30px #0008; display:flex; align-items:center; gap:1rem; opacity:0; transform:translateX(20px); animation:toast-in .4s ease forwards; }
    @keyframes toast-in {to {opacity:1; transform:none}}

    /* Mobile */
    @media (max-width: 1024px){
      .bulk-layout, .checkout-grid, .customizer-layout, .customizer-main {grid-template-columns:1fr}
      #bulk-quote-panel { position: static; margin-top: 2rem; }
      .checkout-summary { border-left: none; border-top: 1px solid var(--border); padding-left: 0; padding-top: 2rem; margin-top: 2rem; }
    }
  </style>
</head>
<body>
  
  <div id="landing-gate">
    <div id="three-canvas"></div>
    <div class="gate-ui">
      <button id="hamburger-btn" aria-label="Open Menu"><div class="bar"></div></button>
      <a href="#support" id="gate-bl" class="gate-link page-link">Contact Us</a>
      <a href="#shop" id="gate-br" class="gate-link enter-site">Shop Now</a>
    </div>
    <div id="gate-menu"><nav>
        <a href="#shop" class="enter-site">Shop</a> <a href="#lookbook" class="enter-site">Lookbook</a>
        <a href="#support" class="enter-site">Contact Us</a> <a href="#policy" class="enter-site">Refund Policy</a>
    </nav></div>
  </div>
  
  <div id="main-content">
    <header class="header"><div class="container header-inner">
        <a href="#shop" class="header-brand page-link">PrintGlow</a>
        <nav class="header-nav">
          <a href="#shop" class="page-link active">Shop</a><a href="#customize" class="page-link">Customize</a>
          <a href="#bulk" class="page-link">Bulk Orders</a><a href="#support" class="page-link">Support</a>
        </nav>
        <button id="cart-btn" class="btn btn-ghost">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
          <span id="cart-count">0</span>
        </button>
    </div></header>

    <main>
      <!-- SHOP PAGE -->
      <section id="shop"><div class="container">
          <h2 class="section-title">All Products</h2>
          <p class="section-sub">Browse our curated collection of high-quality apparel.</p>
          <div id="filter-pills-container" style="display: flex; flex-wrap: wrap; gap: .6rem; margin-bottom: 2rem;"></div>
          <div class="grid items-grid" id="items-grid-container"></div>
      </div></section>

      <!-- CUSTOMIZE PAGE -->
      <section id="customize" class="hidden"><div class="container">
        <h2 class="section-title">Design Studio</h2>
        <p class="section-sub">Create a single custom piece. For larger orders, use our Bulk Quote Builder.</p>
        <div class="customizer-layout">
            <div class="panel">
                <h3>1. Select Product</h3>
                <div id="base-product-list" style="display: grid; gap: 1rem;"></div>
            </div>
            <div class="customizer-main">
                <div style="position: relative;">
                    <div style="position:relative; background: #0c121a; border-radius: var(--radius); overflow:hidden; border: 1px solid var(--border); aspect-ratio: 1/1;">
                        <canvas id="tshirt-canvas" width="800" height="800"></canvas>
                    </div>
                </div>
                <div class="panel">
                    <h3>2. Customize</h3>
                    <div class="field"><label>Upload Image</label><input type="file" id="image-uploader" accept="image/*"></div>
                    <div class="field"><label>Scale</label><input type="range" id="image-scale" min="0.1" max="2" value="0.5" step="0.01"></div>
                    <div class="field"><label>Rotation</label><input type="range" id="image-rotation" min="-180" max="180" value="0" step="1"></div>
                    <button id="add-custom-to-cart-btn" class="btn btn-accent" style="width:100%">Add to Cart</button>
                </div>
            </div>
        </div>
    </div></section>

      <!-- BULK ORDERS PAGE -->
      <section id="bulk" class="hidden"><div class="container">
          <h2 class="section-title">Bulk Quote Builder</h2>
          <p class="section-sub">Design multiple items and add them to your quote request. Perfect for complex orders.</p>
          <div class="bulk-layout">
            <div id="bulk-customizer-panel" class="panel">
                <h3>1. Design an Item</h3>
                <div class="field"><label>Base Product</label><select id="bulk-base-product-select"></select></div>
                <div style="background: #0c121a; border-radius: var(--radius); overflow:hidden; border: 1px solid var(--border); aspect-ratio: 1/1; margin-bottom:1rem;">
                    <canvas id="bulk-tshirt-canvas" width="800" height="800"></canvas>
                </div>
                <div class="field"><label>Upload Artwork</label><input type="file" id="bulk-image-uploader" accept="image/*"></div>
                <div class="field"><label>Quantity</label><input type="number" id="bulk-quantity-input" min="1" value="24" placeholder="Min 24"></div>
                <button id="add-to-quote-btn" class="btn btn-accent" style="width:100%">Add Item to Quote</button>
            </div>
            <div id="bulk-quote-panel" class="panel">
                <h3>2. Your Quote Request</h3>
                <div id="bulk-quote-list"><p>Your quote is empty.</p></div>
                <form id="bulk-order-form">
                    <h3 style="margin-top:2rem;">3. Your Information</h3>
                    <label class="field">Name<input required placeholder="Your Name" /></label>
                    <label class="field">Email<input type="email" required placeholder="your@email.com" /></label>
                    <button class="btn btn-accent" type="submit" style="width:100%">Submit Full Quote Request</button>
                </form>
            </div>
          </div>
      </div></section>

      <!-- SUPPORT PAGE -->
      <section id="support" class="hidden"><div class="container">
        <h2 class="section-title">Support Center</h2>
        <p class="section-sub">Find answers to common questions or get in touch with our team.</p>
        <div style="display:grid; grid-template-columns: 1fr 1.2fr; gap: 2.5rem; align-items:flex-start">
            <div>
                <h3 style="margin-top:0">Frequently Asked Questions</h3>
                <div style="display:grid; gap:1rem">
                    <details style="background:#0e1420; border:1px solid var(--border); border-radius:12px; padding:1rem 1.2rem"><summary style="cursor:pointer; list-style:none; font-weight:600">What’s the turnaround time?</summary><p style="color:var(--muted); margin-top:.8rem">Retail orders ship in 3-5 business days. Bulk orders ship in 5-7 business days after mockup approval.</p></details>
                    <details style="background:#0e1420; border:1px solid var(--border); border-radius:12px; padding:1rem 1.2rem"><summary style="cursor:pointer; list-style:none; font-weight:600">What file types do you accept?</summary><p style="color:var(--muted); margin-top:.8rem">Vector files (AI, SVG) are preferred. We also accept high-resolution PNGs (300 DPI) with a transparent background.</p></details>
                </div>
            </div>
            <form id="support-form" class="panel">
              <h3 style="margin-top:0;">Contact Support</h3>
              <p class="section-sub" style="margin-top:0; margin-bottom:1.5rem">Email us at <a href="mailto:support@printglow.com" style="color:var(--accent)">support@printglow.com</a> or use the form.</p>
               <label class="field">Name<input required/></label>
               <label class="field">Email<input type="email" required/></label>
               <label class="field">Message<textarea rows="5" required></textarea></label>
               <button class="btn btn-accent" type="submit" style="width:100%">Send Message</button>
            </form>
        </div>
      </div></section>
      
      <!-- OTHER PLACEHOLDER PAGES -->
      <section id="lookbook" class="hidden"><div class="container"><h2 class="section-title">Lookbook</h2></div></section>
      <section id="contact" class="hidden"><div class="container"><h2 class="section-title">Contact</h2></div></section>
      <section id="policy" class="hidden"><div class="container"><h2 class="section-title">Refund Policy</h2></div></section>
    </main>

    <footer><div class="container" style="display:flex; justify-content:space-between;">
        <div class="credits">© <span id="year"></span> PrintGlow — Quality Apparel</div>
    </div></footer>
    
    <!-- MODALS -->
    <div class="modal-overlay" id="cart-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Your Cart</h3>
                <button class="modal-close-btn" data-close-modal>&times;</button>
            </div>
            <div id="cart-items"></div>
            <div id="cart-footer" class="hidden">
                <div id="cart-total" style="font-size:1.4rem; font-weight:700; margin-bottom:1rem"></div>
                <button class="btn btn-accent" id="proceed-to-checkout-btn">Proceed to Checkout</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="checkout-modal">
        <div class="modal-content">
             <div class="modal-header">
                <h3 class="modal-title" id="checkout-title">Checkout</h3>
                <button class="modal-close-btn" data-close-modal>&times;</button>
            </div>
            <div class="checkout-grid">
                <div id="checkout-steps">
                    <!-- Step 1: Shipping -->
                    <div id="checkout-step-shipping" class="checkout-step">
                        <h4>Shipping Information</h4>
                        <form id="shipping-form">
                            <label class="field">Full Name<input required /></label>
                            <label class="field">Address<input required /></label>
                            <div style="display:grid; grid-template-columns: 2fr 1fr; gap: 1rem">
                                <label class="field">City<input required /></label>
                                <label class="field">ZIP Code<input required /></label>
                            </div>
                            <button type="submit" class="btn btn-accent" style="width:100%">Continue to Payment</button>
                        </form>
                    </div>
                    <!-- Step 2: Payment -->
                    <div id="checkout-step-payment" class="checkout-step hidden">
                         <h4>Payment Details</h4>
                         <form id="payment-form">
                            <label class="field">Card Number<input placeholder="**** **** **** ****" required /></label>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 1rem">
                                <label class="field">Expiry (MM/YY)<input placeholder="MM/YY" required /></label>
                                <label class="field">CVC<input placeholder="123" required /></label>
                            </div>
                            <button type="submit" class="btn btn-accent" style="width:100%">Place Order</button>
                         </form>
                    </div>
                    <!-- Step 3: Confirmation -->
                    <div id="checkout-step-confirmation" class="checkout-step hidden" style="text-align:center;">
                        <h2 style="color:var(--accent)">Thank You!</h2>
                        <p>Your order has been placed successfully.</p>
                        <p>A confirmation email has been sent (not really!). Your order number is <strong id="order-number"></strong>.</p>
                        <button class="btn" data-close-modal>Close</button>
                    </div>
                </div>
                <div class="checkout-summary">
                    <h4>Order Summary</h4>
                    <div id="checkout-summary-items"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="notification-container"></div>
  </div>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/"
  }
}
</script>

<script type="module">
import * as THREE from 'three';
import { FontLoader } from 'three/addons/loaders/FontLoader.js';
import { TextGeometry } from 'three/addons/geometries/TextGeometry.js';

document.addEventListener('DOMContentLoaded', () => {

    // ======================
    // STATE & DATA
    // ======================
    const state = {
        products: [
            { id: 1, name: 'Classic Tee', price: 24, image: 'https://images.unsplash.com/photo-1622470953794-3a5f80b23acd?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3', category: 'Tees' },
            { id: 2, name: 'Heavyweight Tee', price: 28, image: 'https://images.unsplash.com/photo-1583743814966-8936f5b7be1a?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3', category: 'Tees' },
            { id: 3, name: 'Essential Hoodie', price: 48, image: 'https://images.unsplash.com/photo-1556812191-381c7e2c9490?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3', category: 'Hoodies' },
            { id: 4, name: 'Zip Hoodie', price: 52, image: 'https://images.unsplash.com/photo-1620799140408-edc6d5f9650d?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3', category: 'Hoodies' },
        ],
        baseProducts: [
            { name: 'Classic Tee', price: 26, front: 'https://images.unsplash.com/photo-1622470953794-3a5f80b23acd?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3', back: 'https://images.unsplash.com/photo-1602810318383-e386cc2a3ccf?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3' },
            { name: 'Essential Hoodie', price: 50, front: 'https://images.unsplash.com/photo-1556812191-381c7e2c9490?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3', back: 'https://images.unsplash.com/photo-1610732352827-094627142831?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3' }
        ],
        cart: [],
        bulkQuoteItems: [],
    };
    
    // ======================
    // INITIALIZATION
    // ======================
    function init() {
        initLandingGate();
        initMainSite();
        initShop();
        initCustomizer();
        initBulkOrders();
        initCart();
        initCheckout();
        initForms();
    }
    
    // ================================= //
    //          PAGE LOGIC               //
    // ================================= //

    function initLandingGate() {
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const gateMenu = document.getElementById('gate-menu');
        hamburgerBtn.addEventListener('click', () => {
            hamburgerBtn.classList.toggle('active');
            gateMenu.classList.toggle('open');
        });

        document.querySelectorAll('.enter-site').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const gate = document.getElementById('landing-gate');
                if (gate.classList.contains('out')) return;
                
                gate.classList.add('out');
                hamburgerBtn.classList.remove('active');
                gateMenu.classList.remove('open');
                
                const targetId = link.getAttribute('href');
                setTimeout(() => navigateTo(targetId, true), 800);
            });
        });
        
        const container = document.getElementById('three-canvas');
        if (!container) return;
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);
        camera.position.z = 10;
        
        const pointLight = new THREE.PointLight(0x61e7ff, 200, 100);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));

        let textMesh;
        const fontLoader = new FontLoader();
        fontLoader.load('https://cdn.jsdelivr.net/npm/three@0.164.1/examples/fonts/helvetiker_bold.typeface.json', (font) => {
            const textGeometry = new TextGeometry('PrintGlow', {
                font: font, size: 1.5, height: 0.4, curveSegments: 12,
                bevelEnabled: true, bevelThickness: 0.03, bevelSize: 0.05, bevelOffset: 0, bevelSegments: 5
            });
            textGeometry.center();
            const textMaterial = new THREE.MeshStandardMaterial({ color: 0xe5f1ff, metalness: 0.9, roughness: 0.3 });
            textMesh = new THREE.Mesh(textGeometry, textMaterial);
            scene.add(textMesh);
        });

        let mouseX = 0, mouseY = 0;
        document.addEventListener('mousemove', (e) => {
            mouseX = (e.clientX - window.innerWidth / 2) / 100;
            mouseY = (e.clientY - window.innerHeight / 2) / 100;
        });

        function animate() {
            requestAnimationFrame(animate);
            if (textMesh) {
                textMesh.rotation.y += 0.002;
                camera.position.x += (mouseX - camera.position.x) * 0.05;
                camera.position.y += (-mouseY - camera.position.y) * 0.05;
                camera.lookAt(scene.position);
            }
            renderer.render(scene, camera);
        }
        animate();
    }

    function initMainSite() {
        document.getElementById('year').textContent = new Date().getFullYear();
        document.querySelectorAll('.page-link').forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                navigateTo(link.getAttribute('href'));
            });
        });
    }

    function navigateTo(pageId, isInitial = false) {
        if (!pageId || !document.querySelector(pageId)) {
            pageId = '#shop';
        }
        document.querySelectorAll('main > section').forEach(section => {
            section.classList.toggle('hidden', `#${section.id}` !== pageId);
        });
        document.querySelectorAll('.header-nav a').forEach(link => {
            link.classList.toggle('active', link.getAttribute('href') === pageId);
        });
        if (!isInitial) {
             window.history.pushState(null, '', pageId);
             window.scrollTo(0,0);
        }
    }

    function initShop() {
        const categories = ['All', ...new Set(state.products.map(p => p.category))];
        const container = document.getElementById('filter-pills-container');
        container.innerHTML = categories.map(cat => `<button class="filter-btn ${cat === 'All' ? 'active' : ''}" data-category="${cat}">${cat}</button>`).join('');
        
        container.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                container.querySelector('.active').classList.remove('active');
                btn.classList.add('active');
                renderProducts(btn.dataset.category);
            });
        });
        renderProducts('All');
    }

    function renderProducts(category) {
        const container = document.getElementById('items-grid-container');
        const filtered = category === 'All' ? state.products : state.products.filter(p => p.category === category);
        container.innerHTML = filtered.map(p => `
            <article class="card">
              <div style="aspect-ratio:1; background: #0c121a; display:grid; place-items:center;"><img src="${p.image}" alt="${p.name}"></div>
              <div style="padding:1rem;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                  <strong>${p.name}</strong><span style="font-weight:600">$${p.price.toFixed(2)}</span>
                </div>
                 <button class="btn" style="width:100%; margin-top:1rem;" onclick="app.addToCart(${p.id})">Add to Cart</button>
              </div>
            </article>
        `).join('');
    }

    function initCustomizer() {
        const canvas = new fabric.Canvas('tshirt-canvas', { backgroundColor: '#f0f0f0' });
        let currentProduct = state.baseProducts[0];

        const listContainer = document.getElementById('base-product-list');
        listContainer.innerHTML = state.baseProducts.map((p, i) => `<div class="base-product-item ${i === 0 ? 'active' : ''}" data-index="${i}" style="display: flex; align-items: center; gap: 1rem; padding: .8rem; border-radius: 12px; cursor: pointer;"><img src="${p.front}" alt="${p.name}" style="width: 60px; height: 60px; border-radius: 8px; background: #fff;"><span>${p.name}</span></div>`).join('');
        
        function loadProductImage(product) {
            fabric.Image.fromURL(product.front, (bgImg) => {
                 canvas.setBackgroundImage(bgImg, canvas.renderAll.bind(canvas), {
                    scaleX: canvas.width / bgImg.width,
                    scaleY: canvas.height / bgImg.height,
                 });
            }, { crossOrigin: 'anonymous' });
        }
        
        listContainer.querySelectorAll('.base-product-item').forEach(item => {
            item.addEventListener('click', () => {
                listContainer.querySelector('.active').classList.remove('active');
                item.classList.add('active');
                currentProduct = state.baseProducts[parseInt(item.dataset.index)];
                loadProductImage(currentProduct);
            });
        });
        
        document.getElementById('image-uploader').addEventListener('change', (e) => {
            const file = e.target.files[0]; if (!file) return;
            fabric.Image.fromURL(URL.createObjectURL(file), (img) => {
                const existing = canvas.getObjects('image')[0]; if (existing) canvas.remove(existing);
                img.scaleToWidth(canvas.width * 0.4);
                canvas.add(img).centerObject(img).renderAll();
            });
        });
        
        document.getElementById('image-scale').addEventListener('input', (e) => { const img = canvas.getObjects('image')[0]; if (img) img.scale(parseFloat(e.target.value)).setCoords(); canvas.renderAll(); });
        document.getElementById('image-rotation').addEventListener('input', (e) => { const img = canvas.getObjects('image')[0]; if (img) img.rotate(parseInt(e.target.value)).setCoords(); canvas.renderAll(); });
        document.getElementById('add-custom-to-cart-btn').addEventListener('click', () => {
            const item = { id: Date.now(), name: `Custom ${currentProduct.name}`, price: currentProduct.price, image: canvas.toDataURL({ format: 'png', quality: 0.8 }), quantity: 1 };
            state.cart.push(item);
            renderCart();
            showNotification(`${item.name} added to cart!`);
        });

        loadProductImage(currentProduct);
    }
    
    function initBulkOrders() {
        const canvas = new fabric.Canvas('bulk-tshirt-canvas', { backgroundColor: '#f0f0f0' });
        const productSelect = document.getElementById('bulk-base-product-select');
        let currentProduct = state.baseProducts[0];
        productSelect.innerHTML = state.baseProducts.map((p, i) => `<option value="${i}">${p.name}</option>`).join('');
        
        function loadProductImage(product) {
             fabric.Image.fromURL(product.front, (bgImg) => {
                 canvas.setBackgroundImage(bgImg, canvas.renderAll.bind(canvas), {
                    scaleX: canvas.width / bgImg.width,
                    scaleY: canvas.height / bgImg.height,
                 });
            }, { crossOrigin: 'anonymous' });
        }

        productSelect.addEventListener('change', (e) => {
            currentProduct = state.baseProducts[e.target.value];
            loadProductImage(currentProduct);
        });

        document.getElementById('bulk-image-uploader').addEventListener('change', (e) => {
             const file = e.target.files[0]; if (!file) return;
            fabric.Image.fromURL(URL.createObjectURL(file), (img) => {
                const existing = canvas.getObjects('image')[0]; if (existing) canvas.remove(existing);
                img.scaleToWidth(canvas.width * 0.4);
                canvas.add(img).centerObject(img).renderAll();
            });
        });

        document.getElementById('add-to-quote-btn').addEventListener('click', () => {
            const quantity = document.getElementById('bulk-quantity-input').value;
            if (!quantity || quantity < 1) { showNotification("Please enter a valid quantity.", "danger"); return; }
            const item = { id: Date.now(), name: currentProduct.name, quantity: parseInt(quantity), designDataURL: canvas.toDataURL({ format: 'png', quality: 0.8 }) };
            state.bulkQuoteItems.push(item);
            renderBulkQuoteList();
        });
        
        document.getElementById('bulk-quote-list').addEventListener('click', (e) => {
            if(e.target.matches('.quote-item-remove')) {
                state.bulkQuoteItems = state.bulkQuoteItems.filter(item => item.id !== parseInt(e.target.dataset.id));
                renderBulkQuoteList();
            }
        });

        loadProductImage(currentProduct);
    }

    function renderBulkQuoteList() {
        const container = document.getElementById('bulk-quote-list');
        if (state.bulkQuoteItems.length === 0) { container.innerHTML = '<p>Your quote is empty.</p>'; return; }
        container.innerHTML = state.bulkQuoteItems.map(item => `
            <div class="quote-item">
                <img src="${item.designDataURL}" class="quote-item-img">
                <div><strong>${item.name}</strong><div style="color:var(--muted)">Qty: ${item.quantity}</div></div>
                <button class="quote-item-remove" data-id="${item.id}">&times; Remove</button>
            </div>
        `).join('');
    }

    // ================================= //
    //       CART & CHECKOUT LOGIC       //
    // ================================= //

    function initCart() {
        const cartModal = document.getElementById('cart-modal');
        document.getElementById('cart-btn').addEventListener('click', () => cartModal.classList.add('visible'));
        cartModal.querySelector('[data-close-modal]').addEventListener('click', () => cartModal.classList.remove('visible'));
        
        document.getElementById('cart-items').addEventListener('click', e => {
            const id = parseInt(e.target.dataset.id);
            if (e.target.matches('.remove-item-btn')) removeFromCart(id);
            if (e.target.matches('.quantity-btn')) updateQuantity(id, parseInt(e.target.dataset.change));
        });
    }

    function addToCart(productId) {
        const product = state.products.find(p => p.id === productId); if (!product) return;
        const existing = state.cart.find(item => item.id === productId);
        if (existing) { existing.quantity++; } else { state.cart.push({ ...product, quantity: 1 }); }
        renderCart();
        showNotification(`${product.name} added to cart!`);
    }

    function removeFromCart(productId) {
        state.cart = state.cart.filter(item => item.id !== productId);
        renderCart();
    }
    
    function updateQuantity(productId, change) {
        const item = state.cart.find(i => i.id === productId);
        if (item) {
            item.quantity += change;
            if (item.quantity <= 0) removeFromCart(productId);
            else renderCart();
        }
    }

    function renderCart() {
        const itemsContainer = document.getElementById('cart-items');
        const footer = document.getElementById('cart-footer');
        const totalEl = document.getElementById('cart-total');
        const countEl = document.getElementById('cart-count');

        if (state.cart.length === 0) {
            itemsContainer.innerHTML = '<p>Your cart is empty.</p>';
            footer.classList.add('hidden');
        } else {
            footer.classList.remove('hidden');
            itemsContainer.innerHTML = state.cart.map(item => `
                <div class="cart-item">
                  <img src="${item.image}" alt="${item.name}" class="cart-item-img">
                  <div><strong>${item.name}</strong><div class="price" style="color:var(--muted)">$${item.price.toFixed(2)}</div></div>
                  <div style="text-align:right">
                    <div style="display:flex; align-items:center; gap:.5rem; margin-bottom:.5rem">
                      <button class="quantity-btn" data-id="${item.id}" data-change="-1">-</button>
                      <span>${item.quantity}</span>
                      <button class="quantity-btn" data-id="${item.id}" data-change="1">+</button>
                    </div>
                    <button class="remove-item-btn" data-id="${item.id}" style="font-size:.9rem; color:var(--danger)">Remove</button>
                  </div>
                </div>
            `).join('');
        }
        
        const total = state.cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
        totalEl.textContent = `Total: $${total.toFixed(2)}`;
        
        const count = state.cart.reduce((sum, item) => sum + item.quantity, 0);
        countEl.textContent = count;
        countEl.classList.toggle('visible', count > 0);
    }
    
    function initCheckout() {
        const checkoutModal = document.getElementById('checkout-modal');
        document.getElementById('proceed-to-checkout-btn').addEventListener('click', () => {
            document.getElementById('cart-modal').classList.remove('visible');
            checkoutModal.classList.add('visible');
            renderCheckoutSummary();
            showCheckoutStep('shipping');
        });

        document.getElementById('shipping-form').addEventListener('submit', (e) => { e.preventDefault(); showCheckoutStep('payment'); });
        document.getElementById('payment-form').addEventListener('submit', (e) => {
            e.preventDefault();
            document.getElementById('order-number').textContent = `#${Math.floor(Math.random() * 90000) + 10000}`;
            showCheckoutStep('confirmation');
            state.cart = [];
            renderCart();
        });
        
        checkoutModal.querySelectorAll('[data-close-modal]').forEach(btn => btn.addEventListener('click', () => checkoutModal.classList.remove('visible')));
    }

    function showCheckoutStep(stepName) {
        document.querySelectorAll('.checkout-step').forEach(step => step.classList.add('hidden'));
        document.getElementById(`checkout-step-${stepName}`).classList.remove('hidden');
        document.getElementById('checkout-title').textContent = { shipping: "Checkout: Shipping", payment: "Checkout: Payment", confirmation: "Order Confirmed" }[stepName];
    }
    
    function renderCheckoutSummary() {
        const container = document.getElementById('checkout-summary-items');
        if(state.cart.length === 0) { container.innerHTML = "<p>Your cart is empty.</p>"; return; }
        const total = state.cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
        container.innerHTML = state.cart.map(item => `
            <div style="display:flex; gap:1rem; align-items:center; margin-bottom:1rem;">
                <img src="${item.image}" style="width:60px; height:60px; border-radius:8px;">
                <div><div>${item.name} (x${item.quantity})</div><strong>$${(item.price * item.quantity).toFixed(2)}</strong></div>
            </div>
        `).join('') + `<hr style="border-color:var(--border); margin:1rem 0;"><h4 style="text-align:right;">Total: $${total.toFixed(2)}</h4>`;
    }

    // ================================= //
    //         FORMS & UTILITIES         //
    // ================================= //

    function initForms() {
      document.getElementById('bulk-order-form').addEventListener('submit', e => {
        e.preventDefault();
        showNotification('Quote request sent! We\'ll be in touch soon.');
        e.target.reset();
        state.bulkQuoteItems = [];
        renderBulkQuoteList();
      });

      document.getElementById('support-form').addEventListener('submit', e => {
        e.preventDefault();
        showNotification('Support message sent! We\'ll get back to you shortly.');
        e.target.reset();
      });
    }

    function showNotification(message, type = 'success') {
        const container = document.getElementById('notification-container');
        const toast = document.createElement('div');
        toast.className = `toast`;
        toast.innerHTML = `<span style="color:${type === 'danger' ? 'var(--danger)' : 'var(--accent)'}">✓</span><span>${message}</span>`;
        container.appendChild(toast);
        setTimeout(() => { toast.remove(); }, 3000);
    }

    // Expose functions to global scope
    window.app = { addToCart };
    init();
});
</script>
<!-- Fabric.js library for the customizer canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>

</body>
</html>

